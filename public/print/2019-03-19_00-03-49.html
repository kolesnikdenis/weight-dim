<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Latest compiled and minified CSS -->
	 <link rel="stylesheet" href="/public/bootstrap_4.1.3/css/bootstrap.min.css">
	 <script src="https://unpkg.com/ionicons@4.2.2/dist/ionicons.js"></script>
	<script>

var fun_filter_goods  = (in_array_filter,in_obj)=>{
    //var val = Object.values(in_obj);
    //var key=Object.keys(in_obj);
    var work_obj=in_obj;
    var out={}
    if (in_array_filter.length>0) {
        for (let [key, value] of Object.entries(work_obj)) {
            var test = true;
            for ( var ii=0; in_array_filter.length >ii; ii++ ){
                if (value==in_array_filter[ii] ) {
                    test=false;
                }
            }
            if (test ) { out[key] = value; }{/*console.log("del goods:", value )*/}
        }

    }
    else {
        out=in_obj;
    }/*
    if ( val.length >0 && in_array_filter.length>0)
        for ( var i =0; val.length>i; i++){
            var test = true;
            for ( var ii=0; in_array_filter.length >ii; ii++ ){
                if (val[i] ==in_array_filter[ii] ) {
                    test=false;
                }
            }
            if (test ) { out[key[i]] = val[i]; }{console.log("del:", val[i] )}

        }
    else { out = in_obj;  }*/
    return out;
}


var fun_rename_goods = (filter,in_obj)=>{
    console.log(in_obj);
    var  work_obj = in_obj;
    for (let [key, value] of Object.entries(work_obj)) {
        //console.log(key,"find value:", value);
        for (let [find_val, set_val] of Object.entries(filter)) {
            if (find_val == value) {
                //console.log("меняем на set_val:",set_val);
                work_obj[key]=set_val;
            }
        }
    }
    return work_obj;
}
var  funFilter = (in_array_filter,in_obj)=>{
    var val = Object.values(in_obj);
    var key=Object.keys(in_obj);
    var out={}
    if ( val.length >0 && in_array_filter.length>0)
        for ( var i =0; val.length>i; i++){
            var test = true;
            for ( var ii=0; in_array_filter.length >ii; ii++ ){
                if (val[i] ==in_array_filter[ii] ) {
                    test=false;
                }
            }
            if (test ) { out[key[i]] = val[i]; }{/*console.log("del:", val[i] )*/}

        }
    else { out = in_obj;  }
    return out;
}
</script>
<!-- 22.11.18 -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

<!-- end 22.11.18 -->


<!--  Open Sans Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">

<!-- Optional theme -->
	<link rel="stylesheet" href="/public/bootstrap_4.1.3/css/bootstrap-reboot.min.css">
 	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
	<script src="/public/bootstrap_4.1.3/js/bootstrap.min.js"></script>
  <!-- bootstrap-select -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/infostreams/bootstrap-select/fd227d46de2afed300d97fd0962de80fa71afb3b/dist/css/bootstrap-select.min.css" />
  <script src="https://cdn.rawgit.com/infostreams/bootstrap-select/fd227d46de2afed300d97fd0962de80fa71afb3b/dist/js/bootstrap-select.min.js"></script>
<!-- FontAwesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">

<!-- Main CSS -->
	<link rel="stylesheet" href="/public/css/main.css">
</head>

<script>
  $( document ).ready(function() {
    var t="shipment";
    console.log(t);
    var header_text;
    if (t=="shipment")
       header_text="Отгрузка"
    else 
       header_text="Приход товара"
      $(".header_text").append(header_text);
});
  
</script>


<!--
json: {"dst":{"id":"00008","name":"Блудов ФЛП","create_data_time":"2019-03-19 00:00:44","id_in_1c":"ФР-000008","type_operation":"arrival","destination_type":"contragent"},"package":{"ФР-00000605":{"ItemDescription":"Ящик п/е 1,26кг 600*400*160мм","UnitOfMeasure":"шт","Quantity":"0"},"ФР-00000606":{"ItemDescription":"Ящик п/е 1,8 кг 600*400*260мм","UnitOfMeasure":"шт","Quantity":"0"},"ФР-00000607":{"ItemDescription":"Ящик п/е 0,85кг 600*400*75мм","UnitOfMeasure":"шт","Quantity":"0"},"ФР-00000608":{"ItemDescription":"Піддон пласт 12,5 кг 1200*800мм, синій","UnitOfMeasure":"шт","Quantity":"0"},"chicken":{"ФР-00000014":["4"],"ФР-00000002":["5"]}},"type_package":{"chicken":{"ФР-00000014":["ФР-00000608"],"ФР-00000002":["ФР-00000607"]}},"type":"arrival","shipment":{"chicken":{"ФР-00000014":["42"],"ФР-00000002":["79.75"]}},"price_product":{"chicken":{"ФР-00000014":{"Description":"Тушка кур-бр для розроб. н/ф охол (нефас 20 кг) Цыплята","Price":0},"ФР-00000002":{"Description":"Передня част туш кур-бр без крил, н/ф охол (нефас 20 кг)","Price":0}}},"contragent_name":{"chicken":{"ФР-00000014":"Блудов ФЛП","ФР-00000002":"Блудов ФЛП"}},"ItemDescription":{"chicken":{"ФР-00000014":"Тушка кур-бр для розроб. н/ф охол (нефас 20 кг) Цыплята","ФР-00000002":"Передня част туш кур-бр без крил, н/ф охол (нефас 20 кг)"}},"contact_person":{"chicken":{"ФР-00000014":"","ФР-00000002":""}},"contragent_descr":{"chicken":{"ФР-00000014":"","ФР-00000002":""}}}
price: 
print: 0
-->
<style>
#lline{
 display: flex;
 flex-flow: row-reverse;
}

@media print
{
 .noprint {display:none;}
}

</style>

<header class="head-points noprint">
  <div class="container">
    <div class="row">
        <div class="col-2">
          <a href="javascript:window.history.back();" class="back"> 
            <img src="../../public/img/back.svg" astore_pricelt="назад">
          </a>
        </div>
        <div class="col-8">
          <h1>Накладная</h1>
        </div>
    </div>
  </div>
</header> 


<div class="container">
    <div class="row">
        <div class="col-12">
            <div id=headr_div>
                <div id=line class="line-title">
                    <h1 id=p>Перемещение запасов № </h1>
                    <div id=number>__</div>  от 
                    <div id=from_date>2018-11-11 02:42:17</div>
                </div>
                <div class="d-flex wrapper-direction">
                    <div id=line>От кого: 
                    <div id=from_contragen_store class="direction_to">отправитель</div>
                </div>
                <div id=line class="line-recipient">Кому:  
                    <div id=to_contragen_store class="direction_to">получатель</div>
                </div>
                </div>
            </div>
            <table id=table width='100%' class="table-invoice">
                <thead>
                    <tr width="100%">
                        <th>№</th>
                        <!-- <th>Код</th> -->
                        <th>Товары</th>
                        <th>Количество</th>
                        <th>Цена</th> 
                        <th>Стоимость</th>
                    </tr>
                </thead>
                <tbody id="table-invoice__info"></tbody>
            </table>

            <div id=footer_div>
                <div id=lline >
                    <div id=full_cost>123</div>
                </div>
                <div id=line>
                    <div id=responsible_from>Отпустил: ____________________________</div> 
                    <div id=responsible_to>Получил: ____________________________</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
var obj=({"dst":{"id":"00008","name":"Блудов ФЛП","create_data_time":"2019-03-19 00:00:44","id_in_1c":"ФР-000008","type_operation":"arrival","destination_type":"contragent"},"package":{"ФР-00000605":{"ItemDescription":"Ящик п/е 1,26кг 600*400*160мм","UnitOfMeasure":"шт","Quantity":"0"},"ФР-00000606":{"ItemDescription":"Ящик п/е 1,8 кг 600*400*260мм","UnitOfMeasure":"шт","Quantity":"0"},"ФР-00000607":{"ItemDescription":"Ящик п/е 0,85кг 600*400*75мм","UnitOfMeasure":"шт","Quantity":"0"},"ФР-00000608":{"ItemDescription":"Піддон пласт 12,5 кг 1200*800мм, синій","UnitOfMeasure":"шт","Quantity":"0"},"chicken":{"ФР-00000014":["4"],"ФР-00000002":["5"]}},"type_package":{"chicken":{"ФР-00000014":["ФР-00000608"],"ФР-00000002":["ФР-00000607"]}},"type":"arrival","shipment":{"chicken":{"ФР-00000014":["42"],"ФР-00000002":["79.75"]}},"price_product":{"chicken":{"ФР-00000014":{"Description":"Тушка кур-бр для розроб. н/ф охол (нефас 20 кг) Цыплята","Price":0},"ФР-00000002":{"Description":"Передня част туш кур-бр без крил, н/ф охол (нефас 20 кг)","Price":0}}},"contragent_name":{"chicken":{"ФР-00000014":"Блудов ФЛП","ФР-00000002":"Блудов ФЛП"}},"ItemDescription":{"chicken":{"ФР-00000014":"Тушка кур-бр для розроб. н/ф охол (нефас 20 кг) Цыплята","ФР-00000002":"Передня част туш кур-бр без крил, н/ф охол (нефас 20 кг)"}},"contact_person":{"chicken":{"ФР-00000014":"","ФР-00000002":""}},"contragent_descr":{"chicken":{"ФР-00000014":"","ФР-00000002":""}}});
var goods_chicken=({"turkey":{"product":{"ФР-00000100":"Фарш инд","ФР-00000665":"Кости трубчатые инд","ФР-00000666":"Мясо обрезь с голени инд","ФР-00001107":"Лапы головы  инд","ФР-00000619":"обрезь на фарш ин с крыла","ФР-00000733":"Стейк инд без кости","ФР-00000033":"Тушка індика охолоджена \n","ФР-00000034":"Шиї індика без шкіри\n","ФР-00000035":"Печінка індика\n","ФР-00000036":"Серце індика\n","ФР-00000037":"Шлунки індика\n","ФР-00000038":"филе инд","ФР-00000039":"стейк инд \n","ФР-00000040":"Голень инд","ФР-00000041":"спина инд\n","ФР-00000042":"киль инд","ФР-00000043":"Шкура инд","ФР-00000044":"Задки инд","ФР-00000045":"гуляш инд  \n","ФР-00000046":"крыло инд \n","ФР-00001153":"спина инд¶уценка"}},"chicken":{"product":{"ФР-00001041":"Каркас чищеный перед. частини кур-бр. н/ф  охл","ФР-00000968":"Перекрученное филе","ФР-00000972":"Бедро с хребтом мелкое кур-бр. н/ф  охл","ФР-00000637":"Крило (плеч. част) кур.-бр, н/ф охол (нефас 20кг)","ФР-00000729":"Тушка \"Святкова\" тушка кур-бр н/ф охол","ФР-00000740":"Каркас перед. частини кур-бр. н/ф  охл","ФР-00000005":"Печінка  кур-бр охол  (нефас 10 кг)","ФР-00000006":"Серце  кур-бр охол  (нефас 10 кг)\n","ФР-00000007":"Шлунок м'язовий  кур-бр охол  (нефас 10 кг)\n","ФР-00000008":"Шия  кур-бр охол  (нефас 10 кг)\n","ФР-00000009":"Стегно  кур-бр, н/ф охол  (нефас 20 кг)","ФР-00000010":"Филе  кур-бр, н/ф охол  (нефас 20 кг)","ФР-00000011":"Тушка  кур-бр, н/ф охол  (нефас 20 кг)","ФР-00000012":"Четверт задня  кур-бр, н/ф охол  (нефас 20 кг)","ФР-00000014":"Тушка кур-бр для розроб. н/ф охол (нефас 20 кг) Цыплята","ФР-00000015":"Гомілка  кур-бр, н/ф охол  (нефас 20 кг)","ФР-00000019":"Окорок кур-бр. н/ф охл\n","ФР-00000020":"Бедро с хребтом кур-бр. н/ф  охл","ФР-00000022":"Шкура кур-бр ","ФР-00000023":"Фарш филейный\n","ФР-00000024":"Фарш мясной\n","ФР-00000697":"Кисть крила кур-бр охол (нефас 10 кг)","ФР-00000026":"Хребты кур-бр. н/ф охл\n","ФР-00000027":"Кости кур-бр. н/ф охл","ФР-00000028":"Мясо со шкурой кур-бр. н/ф охл\n","ФР-00000029":"Мясо без шкуры кур-бр. н/ф охл","ФР-00000030":"Жир кур-бр. н/ф охл\n","ФР-00000772":"Філе мале кур-бр, н/ф охол (нефас 20 кг)","ФР-00000002":"Передня част туш кур-бр без крил, н/ф охол (нефас 20 кг)","ФР-00000003":"Крило кур-бр, н/ф охол  (нефас 20 кг)"}},"pork":{"product":{"ФР-00001018":"Мясо с голяшки св","ФР-00001021":"Сало вкусное","ФР-00001022":"Сало тонкое","ФР-00000974":"Вырезка свин.","ФР-00000975":"Отбивная б/к свин","ФР-00000976":"Ошеек свин.","ФР-00000977":"мякоть свин.","ФР-00000978":"Лопатка свин.","ФР-00000979":"Бекон свин.","ФР-00000980":"Голяшка свин.","ФР-00000981":"Нога свин.","ФР-00000982":"Грудинка свин.","ФР-00000983":"Ребра свин.","ФР-00000984":"Пашина свин.","ФР-00000985":"Гуляш свин.","ФР-00000986":"Хребет свин.","ФР-00000987":"Щековина свин.","ФР-00000988":"Шкура свин.","ФР-00000989":"Кости свин.","ФР-00001143":"Рябчики","ФР-00001144":"Мясо (гуляш) для фарша","ФР-00001146":"Ребро суповое свин.","ФР-00001054":"Голова свин.","ФР-00000995":"Мякоть с ребра свин","ФР-00000996":"Фарш Свин.","ФР-00000998":"Сало свин.","ФР-00000999":"Сало с прорезью свин.","ФР-00001000":"Почки свин","ФР-00001001":"Печень свин","ФР-00001002":"Лёгкое свин","ФР-00001003":"Сердце  свин","ФР-00001006":"Кострец свин.","ФР-00001014":"Шашлык свин.","ФР-00001015":"сало бок свин.","ФР-00001046":"Полутуша  Свин."}},"package":{"product":{"ФР-00000605":"Ящик п/е 1,26кг 600*400*160мм","ФР-00000606":"Ящик п/е 1,8 кг 600*400*260мм","ФР-00000607":"Ящик п/е 0,85кг 600*400*75мм","ФР-00000608":"Піддон пласт 12,5 кг 1200*800мм, синій"}}});

var store_price={};
var full_summ=0;
//$('#table').append("<tr><td>1</td><td></td><td>1</td><td>1</td><td>1</td></tr>");
$("#from_date").text(obj.dst.create_data_time);
console.log(obj)
if ( obj.type == "shipment") {
    $("#from_contragen_store").text("Основной склад");
    $("#to_contragen_store").text(obj.dst.name);
}else {
    $("#from_contragen_store").text(obj.dst.name);
    $("#to_contragen_store").text("Основной склад");
}

function add(in_obj) {
   var num_product=0;
   var p = Object.keys(in_obj);
   console.log(p);
   for ( var pi=0; pi<p.length; pi++ ) {
    var category_product=p[pi];
    var product = in_obj[category_product];
    var i=0;
    for (var k in product) {
        if (product.hasOwnProperty(k)) {
            i++;
            var summ=0;
		    var price=0;
            if ( obj.type == "arrival")
                $("#from_contragen_store").text(obj.contragent_name[category_product][k]);
            if (typeof(product[k]) === "object") {
                summ = 0;
                for (var t = 0; t <product[k].length; t++) {
                    var st = product[k][t];
                    summ = parseFloat(summ) + parseFloat(st);

                }
            }
            if ( store_price && k && store_price[k] && store_price[k].Price) {
                price=store_price[k].Price;
                console.log("price:", price, " descr:", store_price[k].Description)
            }else {
                price=0;
            }

            full_summ += price*summ;
            summ=summ.toFixed(3);

	    if (summ>0) {
            $('#table-invoice__info').append("<tr><td>" + num_product + "</td><td>" + goods_chicken[category_product].product[k] + "</td><td>" + summ + " кг</td><td>" + price.toFixed(3) + "</td><td>" + (price * summ).toFixed(3) + "</td></tr>");
            num_product++;
        }

	}
    }
   }
}
add(obj.shipment);
full_summ= full_summ.toFixed(3);
$("#full_cost").text("Итого: " +full_summ+" грн");
function save_and_del_tmp(){
    alert("save and del :D");
    $.ajax({
        url: "/send_to_1c",
        type: "GET",
        cache: false,
        timeout: 5000,
        complete: function() {
            console.log('process complete');
        },
        success: function(data) {
            console.log(data);
            window.print();
            alert("все... конец) вы типа все сделали ");
            console.log('process sucess');
        },
        error: function() {
            console.log("какая то ошибка")
            console.log('process error');
        },
    });

}

(function() {
    var beforePrint = function() {
        console.log('Functionality to run before printing.');
    };

    var afterPrint = function() {
        console.log('Functionality to run after printing');
	window.location.href = "/";
    };

    if (window.matchMedia) {
        var mediaQueryList = window.matchMedia('print');
        mediaQueryList.addListener(function(mql) {
            if (mql.matches) {
                beforePrint();
            } else {
                afterPrint();
            }
        });
    }

    window.onbeforeprint = beforePrint;
    window.onafterprint = afterPrint;

}());


</script>

    <div class="container">
        <div class="row">
            <div class=noprint>
                <a href="javascript:save_and_del_tmp()" class="btn btn-prints">
                    <img src="../../public/img/printer.svg" alt="печать">
                </a>  
                <a href="/" class="btn btn-weight_fix">Сохранить</a> 
            </div>
        </div>
    </div>
</body